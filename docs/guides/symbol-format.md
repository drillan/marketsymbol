# シンボルフォーマット

marketsymbol のシンボルフォーマット仕様を解説します。

## フォーマット概要

シンボルはコロン (`:`) で区切られたセグメントで構成されます。

| 資産クラス | フォーマット | 例 |
|-----------|------------|-----|
| 株式 | `[取引所]:[証券コード]` | `XJPX:7203` |
| 先物 | `[取引所]:[商品コード]:[限月]:F` | `XJPX:NK:20250314:F` |
| オプション (C/P) | `[取引所]:[商品コード]:[限月]:[C/P]:[権利行使価格]` | `XJPX:N225O:20250314:C:42000` |
| オプション (シリーズ) | `[取引所]:[商品コード]:[限月]:O` | `XJPX:N225O:20250314:O` |

## 各フィールドの仕様

### 取引所コード (exchange)

- ISO 10383 MIC (Market Identifier Code) に準拠
- 4文字の英大文字
- 例: `XJPX`（日本取引所グループ）、`XNAS`（NASDAQ）

### 証券/商品コード (code)

- 1〜10文字の英数字
- 株式: 証券コード (例: `7203`)
- デリバティブ: 商品コード (例: `NK`, `N225O`)

```{note}
現在のバリデーションは全資産クラスで 1〜10 文字の範囲をチェックします。
将来的に資産クラスごとの制約（例: 先物は 2〜6 文字）が追加される可能性があります。
```

### 限月 (expiry)

- `YYYYMMDD` 形式の8桁数字
- 有効な日付である必要がある
- 例: `20250314` (2025年3月14日)

```{note}
週次オプションを含むすべての限月は `YYYYMMDD` 形式で統一されています。
詳細は [ADR-002: 限月フォーマットの統一](../adr/symbol/002-weekly-expiry-format.md) を参照してください。
```

### 種別コード (type)

| コード | 説明 | 権利行使価格 |
|--------|------|-------------|
| `F` | 先物 | なし |
| `C` | コールオプション | 必須 |
| `P` | プットオプション | 必須 |
| `O` | オプションシリーズ | なし |

### 権利行使価格 (strike)

- 正の整数
- コール (`C`) とプット (`P`) では必須
- シリーズ (`O`) では指定不可

## バリデーションルール

パース時に以下のバリデーションが実行されます:

| ルール | エラーコード |
|--------|-------------|
| 取引所コードが4文字の英大文字 | E007 |
| 証券コードが1〜10文字の英数字 | E008 |
| 限月が `YYYYMMDD` 形式 | E003 |
| 限月が有効な日付 | E005 |
| 種別コードが `F`, `C`, `P`, `O` のいずれか | E006 |
| 先物に権利行使価格がない | E001 |
| C/P オプションに権利行使価格がある | E002 |
| 権利行使価格が正の整数 | E009 |
| シンボル文字列が100文字以内 | E010 |

## シンボル例

### 株式

```
XJPX:7203      # トヨタ自動車 (東証)
XJPX:9984      # ソフトバンクグループ (東証)
XNAS:AAPL      # Apple (NASDAQ)
```

### 先物

```
XJPX:NK:20250314:F       # 日経225先物 (2025年3月限)
XJPX:TOPIX:20250314:F    # TOPIX先物 (2025年3月限)
```

### オプション

```
XJPX:N225O:20250314:C:42000   # 日経225オプション コール 42000円 (2025年3月限)
XJPX:N225O:20250314:P:38000   # 日経225オプション プット 38000円 (2025年3月限)
XJPX:N225O:20250314:O         # 日経225オプション シリーズ (2025年3月限)
```

## 関連ドキュメント

- [ADR-001: シンボル仕様](../adr/symbol/001-symbol-specification.md)
- [ADR-002: 限月フォーマットの統一](../adr/symbol/002-weekly-expiry-format.md)
- {doc}`../api/errors` - エラーコード詳細
